{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Documents\\\\Project\\\\Don\\\\flare-bible-study\\\\src\\\\components\\\\WorldEmpiresVisualization.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport dataService from '../services/dataService';\nimport './WorldEmpiresVisualization.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WorldEmpiresVisualization = ({\n  textSize,\n  circleSize,\n  onNodeClick\n}) => {\n  _s();\n  const svgRef = useRef();\n  const [currentSize, setCurrentSize] = useState(null);\n  const [originalSize, setOriginalSize] = useState(null);\n  const [plot, setPlot] = useState(null);\n  const [source, setSource] = useState(null);\n  const [timer, setTimer] = useState(null);\n\n  // Editing state\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [editingNode, setEditingNode] = useState(null);\n  const [showAddNodeForm, setShowAddNodeForm] = useState(false);\n  const [newNodeData, setNewNodeData] = useState({\n    name: '',\n    imports: []\n  });\n  const [diagramId, setDiagramId] = useState('world-empires-v1');\n  const [isSaving, setIsSaving] = useState(false);\n  const [saveStatus, setSaveStatus] = useState('');\n\n  // Initialize size on component mount\n  useEffect(() => {\n    if (currentSize === null) {\n      let diam = 10;\n      const windowHeight = window.innerHeight;\n      const windowWidth = window.innerWidth;\n      if (windowHeight < windowWidth && windowHeight >= 600) {\n        diam += windowHeight - 100;\n      } else if (windowHeight < windowWidth && windowHeight < 600) {\n        diam += 560;\n      } else if (windowWidth < windowHeight && windowWidth >= 600) {\n        diam += windowWidth - 100;\n      } else {\n        diam += 560;\n      }\n      setCurrentSize(diam);\n      setOriginalSize(diam);\n    }\n  }, [currentSize]);\n\n  // Update visualization when props change\n  useEffect(() => {\n    if (currentSize && source) {\n      plotHierarchicalEdgeBundling(source);\n    }\n  }, [textSize, circleSize, currentSize, source]);\n\n  // Load data and initialize visualization\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        const response = await fetch('/data/studies/flare-EmpiresInProphecy.json');\n        const data = await response.json();\n        setSource(data);\n        plotHierarchicalEdgeBundling(data);\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n    if (currentSize) {\n      loadData();\n    }\n  }, [currentSize]);\n  const plotHierarchicalEdgeBundling = sourceFile => {\n    setSource(sourceFile);\n    if (plot === null) {\n      setTimer(true);\n      const newPlot = setTimeout(() => {\n        try {\n          d3.select('.heb').style('font-size', `${textSize}em`);\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize);\n          d3.select('.heb svg').style('height', currentSize);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 200);\n    } else {\n      d3.select(\"g\").remove();\n      d3.select(\"svg.bibleStudy\").remove();\n      const newPlot = setTimeout(() => {\n        try {\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize + 100);\n          d3.select('.heb svg').style('height', currentSize + 100);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 400);\n    }\n  };\n\n  // Editing functions\n  const toggleEditMode = () => {\n    setIsEditMode(!isEditMode);\n    if (!isEditMode) {\n      setSelectedNode(null);\n      setEditingNode(null);\n    }\n  };\n  const handleNodeEdit = node => {\n    if (isEditMode) {\n      setEditingNode(node);\n      setNewNodeData({\n        name: node.name,\n        imports: node.imports || []\n      });\n    } else {\n      if (onNodeClick) {\n        onNodeClick(node);\n      }\n    }\n  };\n  const saveNodeEdit = () => {\n    if (editingNode && newNodeData.name) {\n      const updatedSource = source.map(node => node.name === editingNode.name ? {\n        ...node,\n        name: newNodeData.name,\n        imports: newNodeData.imports\n      } : node);\n      setSource(updatedSource);\n      setEditingNode(null);\n      setNewNodeData({\n        name: '',\n        imports: []\n      });\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after editing\n      saveDiagram(updatedSource);\n    }\n  };\n  const addNewNode = () => {\n    if (newNodeData.name) {\n      const newSource = [...source, {\n        name: newNodeData.name,\n        imports: newNodeData.imports\n      }];\n      setSource(newSource);\n      setShowAddNodeForm(false);\n      setNewNodeData({\n        name: '',\n        imports: []\n      });\n      plotHierarchicalEdgeBundling(newSource);\n      // Auto-save after adding\n      saveDiagram(newSource);\n    }\n  };\n  const deleteNode = nodeName => {\n    if (window.confirm(`Are you sure you want to delete \"${nodeName}\"?`)) {\n      const updatedSource = source.filter(node => node.name !== nodeName);\n      setSource(updatedSource);\n      setSelectedNode(null);\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after deletion\n      saveDiagram(updatedSource);\n    }\n  };\n\n  // Save diagram data\n  const saveDiagram = async (dataToSave = source) => {\n    if (!dataToSave) return;\n    setIsSaving(true);\n    setSaveStatus('Saving...');\n    try {\n      // Try to save to backend first\n      await dataService.saveDiagram(diagramId, dataToSave, 'current-user');\n      setSaveStatus('Saved successfully!');\n\n      // Also save to localStorage as backup\n      dataService.saveToLocalStorage(diagramId, dataToSave);\n      setTimeout(() => setSaveStatus(''), 2000);\n    } catch (error) {\n      console.error('Failed to save to backend, using localStorage:', error);\n      // Fallback to localStorage\n      const saved = dataService.saveToLocalStorage(diagramId, dataToSave);\n      setSaveStatus(saved ? 'Saved locally' : 'Save failed');\n      setTimeout(() => setSaveStatus(''), 3000);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Export diagram\n  const exportDiagram = () => {\n    if (source) {\n      dataService.exportDiagram(source, `world-empires-${Date.now()}.json`);\n    }\n  };\n\n  // Import diagram\n  const importDiagram = event => {\n    const file = event.target.files[0];\n    if (file) {\n      dataService.importDiagram(file).then(data => {\n        setSource(data);\n        plotHierarchicalEdgeBundling(data);\n        setSaveStatus('Diagram imported successfully!');\n        setTimeout(() => setSaveStatus(''), 2000);\n      }).catch(error => {\n        setSaveStatus('Import failed: ' + error.message);\n        setTimeout(() => setSaveStatus(''), 3000);\n      });\n    }\n  };\n\n  // HierarchicalEdgeBundling class (converted from original JavaScript)\n  const HierarchicalEdgeBundling = (chartElementId, infoElementId, classes) => {\n    const diameter = currentSize;\n    const radius = diameter / 2;\n    const innerRadius = radius - 120;\n\n    // Create circle cluster\n    const cluster = d3.layout.cluster().size([360, innerRadius]).sort(null).value(function (d) {\n      return d.size;\n    });\n    const bundle = d3.layout.bundle();\n    const line = d3.svg.line.radial().interpolate(\"bundle\").tension(.9).radius(function (d) {\n      return d.y;\n    }).angle(function (d) {\n      return d.x / 180 * Math.PI;\n    });\n\n    // Clear the container before rendering to prevent duplicate diagrams\n    d3.select(\"#\" + chartElementId).selectAll(\"*\").remove();\n\n    // Create SVG element\n    const svg = d3.select(\"#\" + chartElementId).append(\"svg\").attr(\"class\", \"bibleStudy\").attr(\"id\", \"g4\").append(\"g\").attr(\"transform\", \"translate(\" + radius + \",\" + radius + \")\");\n\n    // Link node \"birth place\"\n    let link = svg.append(\"g\").selectAll(\".link\"),\n      node = svg.append(\"g\").selectAll(\".node\");\n\n    // Classes is each \"object\" from the json\n    const nodes = cluster.nodes(packageHierarchy(classes)),\n      links = packageImports(nodes);\n    link = link.data(bundle(links)).enter().append(\"path\").each(function (d) {\n      d.source = d[0], d.target = d[d.length - 1];\n    }).attr(\"class\", \"link\").attr(\"d\", line);\n\n    // Node object\n    node = node.data(nodes.filter(function (n) {\n      return !n.children;\n    })).enter().append(\"text\").attr(\"class\", \"node\").attr(\"dy\", \".31em\").attr(\"transform\", function (d) {\n      return \"rotate(\" + (d.x - 90) + \")translate(\" + (d.y + 8) + \",0)\" + (d.x < 180 ? \"\" : \"rotate(180)\");\n    }).style(\"text-anchor\", function (d) {\n      return d.x < 180 ? \"start\" : \"end\";\n    }).text(function (d) {\n      return d.key;\n    }).on(\"mouseover\", mouseovered).on(\"mouseout\", mouseouted).on(\"click\", clicked).style(\"cursor\", isEditMode ? \"pointer\" : \"default\");\n\n    // Set height for the container\n    d3.select(\"#\" + chartElementId).style(\"height\", diameter + \"px\");\n\n    // Helper functions\n    function packageHierarchy(classes) {\n      const map = {};\n      function find(name, data) {\n        let node = map[name],\n          i;\n        if (!node) {\n          node = map[name] = data || {\n            name: name,\n            children: []\n          };\n          if (name.length) {\n            node.parent = find(name.substring(0, i = name.lastIndexOf(\".\")));\n            node.parent.children.push(node);\n            node.key = name.substring(i + 1);\n          }\n        }\n        return node;\n      }\n      classes.forEach(function (d) {\n        find(d.name, d);\n      });\n      return map[\"\"];\n    }\n    function packageImports(nodes) {\n      const map = {},\n        imports = [];\n\n      // Compute a map from name to node.\n      nodes.forEach(function (d) {\n        map[d.name] = d;\n      });\n\n      // For each import, construct a link from the source to target node.\n      nodes.forEach(function (d) {\n        if (d.imports) d.imports.forEach(function (i) {\n          imports.push({\n            source: map[d.name],\n            target: map[i]\n          });\n        });\n      });\n      return imports;\n    }\n    function mouseovered(d) {\n      node.each(function (n) {\n        n.target = n.source = false;\n      });\n      link.classed(\"link--source\", function (l) {\n        if (l.target === d) return l.source.source = true;\n      }).classed(\"link--target\", function (l) {\n        if (l.source === d) return l.target.target = true;\n      }).filter(function (l) {\n        return l.target === d || l.source === d;\n      }).each(function () {\n        this.parentNode.appendChild(this);\n      });\n      node.classed(\"node--source\", function (n) {\n        return n.source;\n      }).classed(\"node--target\", function (n) {\n        return n.target;\n      });\n    }\n    function mouseouted(d) {\n      link.classed(\"link--source\", false).classed(\"link--target\", false);\n      node.classed(\"node--source\", false).classed(\"node--target\", false);\n    }\n    function clicked(d) {\n      handleNodeEdit(d);\n    }\n    function showTexts(d) {\n      // This would be implemented to show related Bible texts\n      // For now, we'll just log the clicked node\n      console.log('Clicked node:', d);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"visualization-container\",\n    children: [showAddNodeForm && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"add-node-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Add New Node\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Node name (e.g., flare.empires.new.NewEmpire)\",\n        value: newNodeData.name,\n        onChange: e => setNewNodeData({\n          ...newNodeData,\n          name: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Imports (comma-separated)\",\n        value: newNodeData.imports.join(', '),\n        onChange: e => setNewNodeData({\n          ...newNodeData,\n          imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-success\",\n          onClick: addNewNode,\n          children: \"Add Node\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 384,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-secondary\",\n          onClick: () => setShowAddNodeForm(false),\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 383,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 9\n    }, this), editingNode && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"edit-node-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: [\"Edit Node: \", editingNode.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Node name\",\n        value: newNodeData.name,\n        onChange: e => setNewNodeData({\n          ...newNodeData,\n          name: e.target.value\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Imports (comma-separated)\",\n        value: newNodeData.imports.join(', '),\n        onChange: e => setNewNodeData({\n          ...newNodeData,\n          imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-success\",\n          onClick: saveNodeEdit,\n          children: \"Save Changes\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 410,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-secondary\",\n          onClick: () => setEditingNode(null),\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"chtHierarchicalEdgeBundling\",\n      className: \"heb\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 360,\n    columnNumber: 5\n  }, this);\n};\n_s(WorldEmpiresVisualization, \"VtuNW8RCcU2rDOuyI78MZMOhswI=\");\n_c = WorldEmpiresVisualization;\nexport default WorldEmpiresVisualization;\nvar _c;\n$RefreshReg$(_c, \"WorldEmpiresVisualization\");","map":{"version":3,"names":["React","useEffect","useRef","useState","d3","dataService","jsxDEV","_jsxDEV","WorldEmpiresVisualization","textSize","circleSize","onNodeClick","_s","svgRef","currentSize","setCurrentSize","originalSize","setOriginalSize","plot","setPlot","source","setSource","timer","setTimer","isEditMode","setIsEditMode","selectedNode","setSelectedNode","editingNode","setEditingNode","showAddNodeForm","setShowAddNodeForm","newNodeData","setNewNodeData","name","imports","diagramId","setDiagramId","isSaving","setIsSaving","saveStatus","setSaveStatus","diam","windowHeight","window","innerHeight","windowWidth","innerWidth","plotHierarchicalEdgeBundling","loadData","response","fetch","data","json","error","console","sourceFile","newPlot","setTimeout","select","style","HierarchicalEdgeBundling","remove","toggleEditMode","handleNodeEdit","node","saveNodeEdit","updatedSource","map","saveDiagram","addNewNode","newSource","deleteNode","nodeName","confirm","filter","dataToSave","saveToLocalStorage","saved","exportDiagram","Date","now","importDiagram","event","file","target","files","then","catch","message","chartElementId","infoElementId","classes","diameter","radius","innerRadius","cluster","layout","size","sort","value","d","bundle","line","svg","radial","interpolate","tension","y","angle","x","Math","PI","selectAll","append","attr","link","nodes","packageHierarchy","links","packageImports","enter","each","length","n","children","text","key","on","mouseovered","mouseouted","clicked","find","i","parent","substring","lastIndexOf","push","forEach","classed","l","parentNode","appendChild","showTexts","log","className","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","onChange","e","join","split","s","trim","onClick","id","_c","$RefreshReg$"],"sources":["C:/Users/HP/Documents/Project/Don/flare-bible-study/src/components/WorldEmpiresVisualization.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport dataService from '../services/dataService';\nimport './WorldEmpiresVisualization.css';\n\nconst WorldEmpiresVisualization = ({ textSize, circleSize, onNodeClick }) => {\n  const svgRef = useRef();\n  const [currentSize, setCurrentSize] = useState(null);\n  const [originalSize, setOriginalSize] = useState(null);\n  const [plot, setPlot] = useState(null);\n  const [source, setSource] = useState(null);\n  const [timer, setTimer] = useState(null);\n  \n  // Editing state\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [editingNode, setEditingNode] = useState(null);\n  const [showAddNodeForm, setShowAddNodeForm] = useState(false);\n  const [newNodeData, setNewNodeData] = useState({ name: '', imports: [] });\n  const [diagramId, setDiagramId] = useState('world-empires-v1');\n  const [isSaving, setIsSaving] = useState(false);\n  const [saveStatus, setSaveStatus] = useState('');\n\n  // Initialize size on component mount\n  useEffect(() => {\n    if (currentSize === null) {\n      let diam = 10;\n      const windowHeight = window.innerHeight;\n      const windowWidth = window.innerWidth;\n      \n      if ((windowHeight < windowWidth) && (windowHeight >= 600)) {\n        diam += windowHeight - 100;\n      } else if ((windowHeight < windowWidth) && (windowHeight < 600)) {\n        diam += 560;\n      } else if ((windowWidth < windowHeight) && (windowWidth >= 600)) {\n        diam += windowWidth - 100;\n      } else {\n        diam += 560;\n      }\n      \n      setCurrentSize(diam);\n      setOriginalSize(diam);\n    }\n  }, [currentSize]);\n\n  // Update visualization when props change\n  useEffect(() => {\n    if (currentSize && source) {\n      plotHierarchicalEdgeBundling(source);\n    }\n  }, [textSize, circleSize, currentSize, source]);\n\n  // Load data and initialize visualization\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        const response = await fetch('/data/studies/flare-EmpiresInProphecy.json');\n        const data = await response.json();\n        setSource(data);\n        plotHierarchicalEdgeBundling(data);\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n\n    if (currentSize) {\n      loadData();\n    }\n  }, [currentSize]);\n\n  const plotHierarchicalEdgeBundling = (sourceFile) => {\n    setSource(sourceFile);\n    \n    if (plot === null) {\n      setTimer(true);\n      const newPlot = setTimeout(() => {\n        try {\n          d3.select('.heb').style('font-size', `${textSize}em`);\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize);\n          d3.select('.heb svg').style('height', currentSize);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 200);\n    } else {\n      d3.select(\"g\").remove();\n      d3.select(\"svg.bibleStudy\").remove();\n      const newPlot = setTimeout(() => {\n        try {\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize + 100);\n          d3.select('.heb svg').style('height', currentSize + 100);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 400);\n    }\n  };\n\n  // Editing functions\n  const toggleEditMode = () => {\n    setIsEditMode(!isEditMode);\n    if (!isEditMode) {\n      setSelectedNode(null);\n      setEditingNode(null);\n    }\n  };\n\n  const handleNodeEdit = (node) => {\n    if (isEditMode) {\n      setEditingNode(node);\n      setNewNodeData({ name: node.name, imports: node.imports || [] });\n    } else {\n      if (onNodeClick) {\n        onNodeClick(node);\n      }\n    }\n  };\n\n  const saveNodeEdit = () => {\n    if (editingNode && newNodeData.name) {\n      const updatedSource = source.map(node => \n        node.name === editingNode.name \n          ? { ...node, name: newNodeData.name, imports: newNodeData.imports }\n          : node\n      );\n      setSource(updatedSource);\n      setEditingNode(null);\n      setNewNodeData({ name: '', imports: [] });\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after editing\n      saveDiagram(updatedSource);\n    }\n  };\n\n  const addNewNode = () => {\n    if (newNodeData.name) {\n      const newSource = [...source, { name: newNodeData.name, imports: newNodeData.imports }];\n      setSource(newSource);\n      setShowAddNodeForm(false);\n      setNewNodeData({ name: '', imports: [] });\n      plotHierarchicalEdgeBundling(newSource);\n      // Auto-save after adding\n      saveDiagram(newSource);\n    }\n  };\n\n  const deleteNode = (nodeName) => {\n    if (window.confirm(`Are you sure you want to delete \"${nodeName}\"?`)) {\n      const updatedSource = source.filter(node => node.name !== nodeName);\n      setSource(updatedSource);\n      setSelectedNode(null);\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after deletion\n      saveDiagram(updatedSource);\n    }\n  };\n\n  // Save diagram data\n  const saveDiagram = async (dataToSave = source) => {\n    if (!dataToSave) return;\n    \n    setIsSaving(true);\n    setSaveStatus('Saving...');\n    \n    try {\n      // Try to save to backend first\n      await dataService.saveDiagram(diagramId, dataToSave, 'current-user');\n      setSaveStatus('Saved successfully!');\n      \n      // Also save to localStorage as backup\n      dataService.saveToLocalStorage(diagramId, dataToSave);\n      \n      setTimeout(() => setSaveStatus(''), 2000);\n    } catch (error) {\n      console.error('Failed to save to backend, using localStorage:', error);\n      // Fallback to localStorage\n      const saved = dataService.saveToLocalStorage(diagramId, dataToSave);\n      setSaveStatus(saved ? 'Saved locally' : 'Save failed');\n      setTimeout(() => setSaveStatus(''), 3000);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Export diagram\n  const exportDiagram = () => {\n    if (source) {\n      dataService.exportDiagram(source, `world-empires-${Date.now()}.json`);\n    }\n  };\n\n  // Import diagram\n  const importDiagram = (event) => {\n    const file = event.target.files[0];\n    if (file) {\n      dataService.importDiagram(file)\n        .then(data => {\n          setSource(data);\n          plotHierarchicalEdgeBundling(data);\n          setSaveStatus('Diagram imported successfully!');\n          setTimeout(() => setSaveStatus(''), 2000);\n        })\n        .catch(error => {\n          setSaveStatus('Import failed: ' + error.message);\n          setTimeout(() => setSaveStatus(''), 3000);\n        });\n    }\n  };\n\n  // HierarchicalEdgeBundling class (converted from original JavaScript)\n  const HierarchicalEdgeBundling = (chartElementId, infoElementId, classes) => {\n    const diameter = currentSize;\n    const radius = diameter / 2;\n    const innerRadius = radius - 120;\n\n    // Create circle cluster\n    const cluster = d3.layout.cluster()\n      .size([360, innerRadius])\n      .sort(null)\n      .value(function(d) { return d.size; });\n\n    const bundle = d3.layout.bundle();\n\n    const line = d3.svg.line.radial()\n      .interpolate(\"bundle\")\n      .tension(.9)\n      .radius(function(d) { return d.y; })\n      .angle(function(d) { return d.x / 180 * Math.PI; });\n\n    // Clear the container before rendering to prevent duplicate diagrams\n    d3.select(\"#\" + chartElementId).selectAll(\"*\").remove();\n\n    // Create SVG element\n    const svg = d3.select(\"#\" + chartElementId).append(\"svg\")\n      .attr(\"class\", \"bibleStudy\")\n      .attr(\"id\", \"g4\")\n      .append(\"g\")\n      .attr(\"transform\", \"translate(\" + radius + \",\" + radius + \")\");\n\n    // Link node \"birth place\"\n    let link = svg.append(\"g\").selectAll(\".link\"),\n        node = svg.append(\"g\").selectAll(\".node\");\n\n    // Classes is each \"object\" from the json\n    const nodes = cluster.nodes(packageHierarchy(classes)),\n          links = packageImports(nodes);\n\n    link = link\n      .data(bundle(links))\n      .enter().append(\"path\")\n      .each(function(d) { d.source = d[0], d.target = d[d.length - 1]; })\n      .attr(\"class\", \"link\")\n      .attr(\"d\", line);\n\n    // Node object\n    node = node\n      .data(nodes.filter(function(n) { return !n.children; }))\n      .enter().append(\"text\")\n      .attr(\"class\", \"node\")\n      .attr(\"dy\", \".31em\")\n      .attr(\"transform\", function(d) { \n        return \"rotate(\" + (d.x - 90) + \")translate(\" + (d.y + 8) + \",0)\" + (d.x < 180 ? \"\" : \"rotate(180)\"); \n      })\n      .style(\"text-anchor\", function(d) { return d.x < 180 ? \"start\" : \"end\"; })\n      .text(function(d) { return d.key; })\n      .on(\"mouseover\", mouseovered)\n      .on(\"mouseout\", mouseouted)\n      .on(\"click\", clicked)\n      .style(\"cursor\", isEditMode ? \"pointer\" : \"default\");\n\n    // Set height for the container\n    d3.select(\"#\" + chartElementId).style(\"height\", diameter + \"px\");\n\n    // Helper functions\n    function packageHierarchy(classes) {\n      const map = {};\n      \n      function find(name, data) {\n        let node = map[name], i;\n        if (!node) {\n          node = map[name] = data || {name: name, children: []};\n          if (name.length) {\n            node.parent = find(name.substring(0, i = name.lastIndexOf(\".\")));\n            node.parent.children.push(node);\n            node.key = name.substring(i + 1);\n          }\n        }\n        return node;\n      }\n      \n      classes.forEach(function(d) {\n        find(d.name, d);\n      });\n      \n      return map[\"\"];\n    }\n\n    function packageImports(nodes) {\n      const map = {},\n            imports = [];\n      \n      // Compute a map from name to node.\n      nodes.forEach(function(d) {\n        map[d.name] = d;\n      });\n      \n      // For each import, construct a link from the source to target node.\n      nodes.forEach(function(d) {\n        if (d.imports) d.imports.forEach(function(i) {\n          imports.push({source: map[d.name], target: map[i]});\n        });\n      });\n      \n      return imports;\n    }\n\n    function mouseovered(d) {\n      node\n        .each(function(n) { n.target = n.source = false; });\n      \n      link\n        .classed(\"link--source\", function(l) { if (l.target === d) return l.source.source = true; })\n        .classed(\"link--target\", function(l) { if (l.source === d) return l.target.target = true; })\n        .filter(function(l) { return l.target === d || l.source === d; })\n        .each(function() { this.parentNode.appendChild(this); });\n      \n      node\n        .classed(\"node--source\", function(n) { return n.source; })\n        .classed(\"node--target\", function(n) { return n.target; });\n    }\n\n    function mouseouted(d) {\n      link\n        .classed(\"link--source\", false)\n        .classed(\"link--target\", false);\n      \n      node\n        .classed(\"node--source\", false)\n        .classed(\"node--target\", false);\n    }\n\n    function clicked(d) {\n      handleNodeEdit(d);\n    }\n\n    function showTexts(d) {\n      // This would be implemented to show related Bible texts\n      // For now, we'll just log the clicked node\n      console.log('Clicked node:', d);\n    }\n  };\n\n  return (\n    <div className=\"visualization-container\">\n      {/* Edit Controls */}\n      \n\n      {/* Add Node Form */}\n      {showAddNodeForm && (\n        <div className=\"add-node-form\">\n          <h4>Add New Node</h4>\n          <input\n            type=\"text\"\n            placeholder=\"Node name (e.g., flare.empires.new.NewEmpire)\"\n            value={newNodeData.name}\n            onChange={(e) => setNewNodeData({...newNodeData, name: e.target.value})}\n          />\n          <input\n            type=\"text\"\n            placeholder=\"Imports (comma-separated)\"\n            value={newNodeData.imports.join(', ')}\n            onChange={(e) => setNewNodeData({\n              ...newNodeData, \n              imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n            })}\n          />\n          <div className=\"form-buttons\">\n            <button className=\"btn btn-success\" onClick={addNewNode}>Add Node</button>\n            <button className=\"btn btn-secondary\" onClick={() => setShowAddNodeForm(false)}>Cancel</button>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Node Form */}\n      {editingNode && (\n        <div className=\"edit-node-form\">\n          <h4>Edit Node: {editingNode.name}</h4>\n          <input\n            type=\"text\"\n            placeholder=\"Node name\"\n            value={newNodeData.name}\n            onChange={(e) => setNewNodeData({...newNodeData, name: e.target.value})}\n          />\n          <input\n            type=\"text\"\n            placeholder=\"Imports (comma-separated)\"\n            value={newNodeData.imports.join(', ')}\n            onChange={(e) => setNewNodeData({\n              ...newNodeData, \n              imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n            })}\n          />\n          <div className=\"form-buttons\">\n            <button className=\"btn btn-success\" onClick={saveNodeEdit}>Save Changes</button>\n            <button className=\"btn btn-secondary\" onClick={() => setEditingNode(null)}>Cancel</button>\n          </div>\n        </div>\n      )}\n\n      {/* Visualization */}\n      <div id=\"chtHierarchicalEdgeBundling\" className=\"heb\">\n        {/* D3.js will render the visualization here */}\n      </div>\n    </div>\n  );\n};\n\nexport default WorldEmpiresVisualization; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}