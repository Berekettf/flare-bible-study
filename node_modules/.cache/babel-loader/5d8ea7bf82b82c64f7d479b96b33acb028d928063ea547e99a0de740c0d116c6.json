{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Documents\\\\Project\\\\Don\\\\flare-bible-study\\\\src\\\\components\\\\WorldEmpires\\\\WorldEmpiresVisualization.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport dataService from '../../services/dataService';\nimport './WorldEmpiresVisualization.css';\nimport InfoPanel from './InfoPanel.tsx';\nimport './InfoPanel.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst WorldEmpiresVisualization = ({\n  textSize,\n  circleSize,\n  onNodeClick\n}) => {\n  _s();\n  const svgRef = useRef();\n  const [currentSize, setCurrentSize] = useState(null);\n  const [originalSize, setOriginalSize] = useState(null);\n  const [plot, setPlot] = useState(null);\n  const [source, setSource] = useState(null);\n  const [timer, setTimer] = useState(null);\n\n  // Editing state\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [editingNode, setEditingNode] = useState(null);\n  const [showAddNodeForm, setShowAddNodeForm] = useState(false);\n  const [newNodeData, setNewNodeData] = useState({\n    name: '',\n    imports: []\n  });\n  const [diagramId, setDiagramId] = useState('world-empires-v1');\n  const [isSaving, setIsSaving] = useState(false);\n  const [saveStatus, setSaveStatus] = useState('');\n\n  // Initialize size on component mount\n  useEffect(() => {\n    if (currentSize === null) {\n      let diam = 10;\n      const windowHeight = window.innerHeight;\n      const windowWidth = window.innerWidth;\n      if (windowHeight < windowWidth && windowHeight >= 600) {\n        diam += windowHeight - 100;\n      } else if (windowHeight < windowWidth && windowHeight < 600) {\n        diam += 560;\n      } else if (windowWidth < windowHeight && windowWidth >= 600) {\n        diam += windowWidth - 100;\n      } else {\n        diam += 560;\n      }\n      setCurrentSize(diam);\n      setOriginalSize(diam);\n    }\n  }, [currentSize]);\n\n  // Update visualization when props change\n  useEffect(() => {\n    if (currentSize && source) {\n      plotHierarchicalEdgeBundling(source);\n    }\n  }, [textSize, circleSize, currentSize, source]);\n\n  // Load data and initialize visualization\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        // Fetch from the new API endpoint\n        const response = await fetch('http://localhost:3000/empires-nodes');\n        const data = await response.json();\n        // Ensure size is a number for all nodes\n        const fixedData = data.map(node => ({\n          ...node,\n          size: typeof node.size === 'number' && !isNaN(node.size) ? node.size : 1\n        }));\n        setSource(fixedData);\n        plotHierarchicalEdgeBundling(fixedData);\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n    if (currentSize) {\n      loadData();\n    }\n  }, [currentSize]);\n  const plotHierarchicalEdgeBundling = sourceFile => {\n    setSource(sourceFile);\n    if (plot === null) {\n      setTimer(true);\n      const newPlot = setTimeout(() => {\n        try {\n          d3.select('.heb').style('font-size', `${textSize}em`);\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize);\n          d3.select('.heb svg').style('height', currentSize);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 200);\n    } else {\n      d3.select(\"g\").remove();\n      d3.select(\"svg.bibleStudy\").remove();\n      const newPlot = setTimeout(() => {\n        try {\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize + 100);\n          d3.select('.heb svg').style('height', currentSize + 100);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 400);\n    }\n  };\n\n  // Editing functions\n  const toggleEditMode = () => {\n    setIsEditMode(!isEditMode);\n    if (!isEditMode) {\n      setSelectedNode(null);\n      setEditingNode(null);\n    }\n  };\n  const handleNodeEdit = node => {\n    if (isEditMode) {\n      setEditingNode(node);\n      setNewNodeData({\n        name: node.name,\n        imports: node.imports || []\n      });\n    } else {\n      if (onNodeClick) {\n        onNodeClick(node);\n      }\n    }\n  };\n  const saveNodeEdit = () => {\n    if (editingNode && newNodeData.name) {\n      const updatedSource = source.map(node => node.name === editingNode.name ? {\n        ...node,\n        name: newNodeData.name,\n        imports: newNodeData.imports\n      } : node);\n      setSource(updatedSource);\n      setEditingNode(null);\n      setNewNodeData({\n        name: '',\n        imports: []\n      });\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after editing\n      saveDiagram(updatedSource);\n    }\n  };\n  const addNewNode = () => {\n    if (newNodeData.name) {\n      const newSource = [...source, {\n        name: newNodeData.name,\n        imports: newNodeData.imports\n      }];\n      setSource(newSource);\n      setShowAddNodeForm(false);\n      setNewNodeData({\n        name: '',\n        imports: []\n      });\n      plotHierarchicalEdgeBundling(newSource);\n      // Auto-save after adding\n      saveDiagram(newSource);\n    }\n  };\n  const deleteNode = nodeName => {\n    if (window.confirm(`Are you sure you want to delete \"${nodeName}\"?`)) {\n      const updatedSource = source.filter(node => node.name !== nodeName);\n      setSource(updatedSource);\n      setSelectedNode(null);\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after deletion\n      saveDiagram(updatedSource);\n    }\n  };\n\n  // Save diagram data\n  const saveDiagram = async (dataToSave = source) => {\n    if (!dataToSave) return;\n    setIsSaving(true);\n    setSaveStatus('Saving...');\n    try {\n      // Try to save to backend first\n      await dataService.saveDiagram(diagramId, dataToSave, 'current-user');\n      setSaveStatus('Saved successfully!');\n\n      // Also save to localStorage as backup\n      dataService.saveToLocalStorage(diagramId, dataToSave);\n      setTimeout(() => setSaveStatus(''), 2000);\n    } catch (error) {\n      console.error('Failed to save to backend, using localStorage:', error);\n      // Fallback to localStorage\n      const saved = dataService.saveToLocalStorage(diagramId, dataToSave);\n      setSaveStatus(saved ? 'Saved locally' : 'Save failed');\n      setTimeout(() => setSaveStatus(''), 3000);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Export diagram\n  const exportDiagram = () => {\n    if (source) {\n      dataService.exportDiagram(source, `world-empires-${Date.now()}.json`);\n    }\n  };\n\n  // Import diagram\n  const importDiagram = event => {\n    const file = event.target.files[0];\n    if (file) {\n      dataService.importDiagram(file).then(data => {\n        setSource(data);\n        plotHierarchicalEdgeBundling(data);\n        setSaveStatus('Diagram imported successfully!');\n        setTimeout(() => setSaveStatus(''), 2000);\n      }).catch(error => {\n        setSaveStatus('Import failed: ' + error.message);\n        setTimeout(() => setSaveStatus(''), 3000);\n      });\n    }\n  };\n\n  // HierarchicalEdgeBundling class (converted from original JavaScript)\n  const HierarchicalEdgeBundling = (chartElementId, infoElementId, classes) => {\n    const diameter = currentSize;\n    const radius = diameter / 2;\n    const innerRadius = radius - 120;\n\n    // Create circle cluster\n    const cluster = d3.layout.cluster().size([360, innerRadius]).sort(null).value(function (d) {\n      return d.size;\n    });\n    const bundle = d3.layout.bundle();\n    const line = d3.svg.line.radial().interpolate(\"bundle\").tension(.9).radius(function (d) {\n      return d.y;\n    }).angle(function (d) {\n      return d.x / 180 * Math.PI;\n    });\n\n    // Clear the container before rendering to prevent duplicate diagrams\n    d3.select(\"#\" + chartElementId).selectAll(\"*\").remove();\n\n    // Create SVG element\n    const svg = d3.select(\"#\" + chartElementId).append(\"svg\").attr(\"class\", \"bibleStudy\").attr(\"id\", \"g4\").append(\"g\").attr(\"transform\", \"translate(\" + radius + \",\" + radius + \")\");\n\n    // Link node \"birth place\"\n    let link = svg.append(\"g\").selectAll(\".link\"),\n      node = svg.append(\"g\").selectAll(\".node\");\n\n    // Classes is each \"object\" from the json\n    const nodes = cluster.nodes(packageHierarchy(classes)),\n      links = packageImports(nodes);\n    link = link.data(bundle(links)).enter().append(\"path\").each(function (d) {\n      d.source = d[0], d.target = d[d.length - 1];\n    }).attr(\"class\", \"link\").attr(\"d\", line);\n\n    // Node object\n    node = node.data(nodes.filter(function (n) {\n      return !n.children;\n    })).enter().append(\"text\").attr(\"class\", \"node\").attr(\"dy\", \".31em\").attr(\"transform\", function (d) {\n      return \"rotate(\" + (d.x - 90) + \")translate(\" + (d.y + 8) + \",0)\" + (d.x < 180 ? \"\" : \"rotate(180)\");\n    }).style(\"text-anchor\", function (d) {\n      return d.x < 180 ? \"start\" : \"end\";\n    }).text(function (d) {\n      return d.key;\n    }).on(\"mouseover\", mouseovered).on(\"mouseout\", mouseouted).on(\"click\", clicked).style(\"cursor\", isEditMode ? \"pointer\" : \"default\");\n\n    // Set height for the container\n    d3.select(\"#\" + chartElementId).style(\"height\", diameter + \"px\");\n\n    // Helper functions\n    function packageHierarchy(classes) {\n      const map = {};\n      function find(name, data) {\n        let node = map[name],\n          i;\n        if (!node) {\n          node = map[name] = data || {\n            name: name,\n            children: []\n          };\n          if (name.length) {\n            node.parent = find(name.substring(0, i = name.lastIndexOf(\".\")));\n            node.parent.children.push(node);\n            node.key = name.substring(i + 1);\n          }\n        }\n        return node;\n      }\n      classes.forEach(function (d) {\n        find(d.name, d);\n      });\n      return map[\"\"];\n    }\n    function packageImports(nodes) {\n      const map = {},\n        imports = [];\n\n      // Compute a map from name to node.\n      nodes.forEach(function (d) {\n        map[d.name] = d;\n      });\n\n      // For each import, construct a link from the source to target node.\n      nodes.forEach(function (d) {\n        if (d.imports) d.imports.forEach(function (i) {\n          imports.push({\n            source: map[d.name],\n            target: map[i]\n          });\n        });\n      });\n      return imports;\n    }\n    function mouseovered(d) {\n      node.each(function (n) {\n        n.target = n.source = false;\n      });\n      link.classed(\"link--source\", function (l) {\n        if (l.target === d) return l.source.source = true;\n      }).classed(\"link--target\", function (l) {\n        if (l.source === d) return l.target.target = true;\n      }).filter(function (l) {\n        return l.target === d || l.source === d;\n      }).each(function () {\n        this.parentNode.appendChild(this);\n      });\n      node.classed(\"node--source\", function (n) {\n        return n.source;\n      }).classed(\"node--target\", function (n) {\n        return n.target;\n      });\n    }\n    function mouseouted(d) {\n      link.classed(\"link--source\", false).classed(\"link--target\", false);\n      node.classed(\"node--source\", false).classed(\"node--target\", false);\n    }\n    function clicked(d) {\n      handleNodeEdit(d);\n    }\n    function showTexts(d) {\n      // This would be implemented to show related Bible texts\n      // For now, we'll just log the clicked node\n      console.log('Clicked node:', d);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row world-empires-row\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-12 col-lg-9 position-relative\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"chtHierarchicalEdgeBundling\",\n        className: \"heb\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"edit-controls-float btn-group btn-group-sm float-end\",\n          style: {\n            position: 'absolute',\n            top: 12,\n            right: 12,\n            zIndex: 10\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `btn btn-sm ${isEditMode ? 'btn-danger' : 'btn-primary'}`,\n            onClick: toggleEditMode,\n            title: isEditMode ? 'Exit Edit Mode' : 'Enter Edit Mode',\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: `mdi ${isEditMode ? 'mdi-close' : 'mdi-pencil'}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 13\n          }, this), isEditMode && /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-sm btn-success\",\n              onClick: () => setShowAddNodeForm(true),\n              title: \"Add New Node\",\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"mdi mdi-plus\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 389,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 17\n            }, this), selectedNode && /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-sm btn-warning\",\n              onClick: () => deleteNode(selectedNode.name),\n              title: \"Delete Selected\",\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"mdi mdi-delete\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 397,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 392,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-sm btn-info\",\n            onClick: () => saveDiagram(),\n            disabled: isSaving,\n            title: \"Save\",\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"mdi mdi-content-save\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-sm btn-secondary\",\n            onClick: exportDiagram,\n            title: \"Export\",\n            children: /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"mdi mdi-export\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 415,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 410,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"btn btn-sm btn-outline-secondary mb-0\",\n            title: \"Import\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"mdi mdi-import\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"file\",\n              accept: \".json\",\n              onChange: importDiagram,\n              style: {\n                display: 'none'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 419,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 9\n      }, this), saveStatus && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"save-status mt-2 text-end\",\n        children: saveStatus\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 11\n      }, this), showAddNodeForm && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"add-node-form mt-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Add New Node\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 437,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Node name (e.g., flare.empires.new.NewEmpire)\",\n          value: newNodeData.name,\n          onChange: e => setNewNodeData({\n            ...newNodeData,\n            name: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 438,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Imports (comma-separated)\",\n          value: newNodeData.imports.join(', '),\n          onChange: e => setNewNodeData({\n            ...newNodeData,\n            imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 444,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-buttons mt-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-success btn-sm\",\n            onClick: addNewNode,\n            children: \"Add Node\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 454,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-secondary btn-sm\",\n            onClick: () => setShowAddNodeForm(false),\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 455,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 11\n      }, this), editingNode && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"edit-node-form mt-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: [\"Edit Node: \", editingNode.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Node name\",\n          value: newNodeData.name,\n          onChange: e => setNewNodeData({\n            ...newNodeData,\n            name: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 463,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Imports (comma-separated)\",\n          value: newNodeData.imports.join(', '),\n          onChange: e => setNewNodeData({\n            ...newNodeData,\n            imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 469,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-buttons mt-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-success btn-sm\",\n            onClick: saveNodeEdit,\n            children: \"Save Changes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 479,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-secondary btn-sm\",\n            onClick: () => setEditingNode(null),\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 480,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 478,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-12 col-lg-3 mobile\",\n      children: /*#__PURE__*/_jsxDEV(InfoPanel, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 485,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 368,\n    columnNumber: 5\n  }, this);\n};\n_s(WorldEmpiresVisualization, \"VtuNW8RCcU2rDOuyI78MZMOhswI=\");\n_c = WorldEmpiresVisualization;\nexport default WorldEmpiresVisualization;\nvar _c;\n$RefreshReg$(_c, \"WorldEmpiresVisualization\");","map":{"version":3,"names":["React","useEffect","useRef","useState","d3","dataService","InfoPanel","jsxDEV","_jsxDEV","Fragment","_Fragment","WorldEmpiresVisualization","textSize","circleSize","onNodeClick","_s","svgRef","currentSize","setCurrentSize","originalSize","setOriginalSize","plot","setPlot","source","setSource","timer","setTimer","isEditMode","setIsEditMode","selectedNode","setSelectedNode","editingNode","setEditingNode","showAddNodeForm","setShowAddNodeForm","newNodeData","setNewNodeData","name","imports","diagramId","setDiagramId","isSaving","setIsSaving","saveStatus","setSaveStatus","diam","windowHeight","window","innerHeight","windowWidth","innerWidth","plotHierarchicalEdgeBundling","loadData","response","fetch","data","json","fixedData","map","node","size","isNaN","error","console","sourceFile","newPlot","setTimeout","select","style","HierarchicalEdgeBundling","remove","toggleEditMode","handleNodeEdit","saveNodeEdit","updatedSource","saveDiagram","addNewNode","newSource","deleteNode","nodeName","confirm","filter","dataToSave","saveToLocalStorage","saved","exportDiagram","Date","now","importDiagram","event","file","target","files","then","catch","message","chartElementId","infoElementId","classes","diameter","radius","innerRadius","cluster","layout","sort","value","d","bundle","line","svg","radial","interpolate","tension","y","angle","x","Math","PI","selectAll","append","attr","link","nodes","packageHierarchy","links","packageImports","enter","each","length","n","children","text","key","on","mouseovered","mouseouted","clicked","find","i","parent","substring","lastIndexOf","push","forEach","classed","l","parentNode","appendChild","showTexts","log","className","id","position","top","right","zIndex","onClick","title","fileName","_jsxFileName","lineNumber","columnNumber","disabled","type","accept","onChange","display","placeholder","e","join","split","s","trim","_c","$RefreshReg$"],"sources":["C:/Users/HP/Documents/Project/Don/flare-bible-study/src/components/WorldEmpires/WorldEmpiresVisualization.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport dataService from '../../services/dataService';\nimport './WorldEmpiresVisualization.css';\nimport InfoPanel from './InfoPanel.tsx';\nimport './InfoPanel.css';\n\nconst WorldEmpiresVisualization = ({ textSize, circleSize, onNodeClick }) => {\n  const svgRef = useRef();\n  const [currentSize, setCurrentSize] = useState(null);\n  const [originalSize, setOriginalSize] = useState(null);\n  const [plot, setPlot] = useState(null);\n  const [source, setSource] = useState(null);\n  const [timer, setTimer] = useState(null);\n  \n  // Editing state\n  const [isEditMode, setIsEditMode] = useState(false);\n  const [selectedNode, setSelectedNode] = useState(null);\n  const [editingNode, setEditingNode] = useState(null);\n  const [showAddNodeForm, setShowAddNodeForm] = useState(false);\n  const [newNodeData, setNewNodeData] = useState({ name: '', imports: [] });\n  const [diagramId, setDiagramId] = useState('world-empires-v1');\n  const [isSaving, setIsSaving] = useState(false);\n  const [saveStatus, setSaveStatus] = useState('');\n\n  // Initialize size on component mount\n  useEffect(() => {\n    if (currentSize === null) {\n      let diam = 10;\n      const windowHeight = window.innerHeight;\n      const windowWidth = window.innerWidth;\n      \n      if ((windowHeight < windowWidth) && (windowHeight >= 600)) {\n        diam += windowHeight - 100;\n      } else if ((windowHeight < windowWidth) && (windowHeight < 600)) {\n        diam += 560;\n      } else if ((windowWidth < windowHeight) && (windowWidth >= 600)) {\n        diam += windowWidth - 100;\n      } else {\n        diam += 560;\n      }\n      \n      setCurrentSize(diam);\n      setOriginalSize(diam);\n    }\n  }, [currentSize]);\n\n  // Update visualization when props change\n  useEffect(() => {\n    if (currentSize && source) {\n      plotHierarchicalEdgeBundling(source);\n    }\n  }, [textSize, circleSize, currentSize, source]);\n\n  // Load data and initialize visualization\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        // Fetch from the new API endpoint\n        const response = await fetch('http://localhost:3000/empires-nodes');\n        const data = await response.json();\n        // Ensure size is a number for all nodes\n        const fixedData = data.map(node => ({\n          ...node,\n          size: (typeof node.size === 'number' && !isNaN(node.size)) ? node.size : 1\n        }));\n        setSource(fixedData);\n        plotHierarchicalEdgeBundling(fixedData);\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n\n    if (currentSize) {\n      loadData();\n    }\n  }, [currentSize]);\n\n  const plotHierarchicalEdgeBundling = (sourceFile) => {\n    setSource(sourceFile);\n    \n    if (plot === null) {\n      setTimer(true);\n      const newPlot = setTimeout(() => {\n        try {\n          d3.select('.heb').style('font-size', `${textSize}em`);\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize);\n          d3.select('.heb svg').style('height', currentSize);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 200);\n    } else {\n      d3.select(\"g\").remove();\n      d3.select(\"svg.bibleStudy\").remove();\n      const newPlot = setTimeout(() => {\n        try {\n          HierarchicalEdgeBundling(\"chtHierarchicalEdgeBundling\", \"infoHierarchicalEdgeBundling\", sourceFile);\n          d3.select('.heb svg').style('width', currentSize + 100);\n          d3.select('.heb svg').style('height', currentSize + 100);\n        } catch (error) {\n          console.error('Error in HierarchicalEdgeBundling:', error);\n        }\n      }, 300);\n      setPlot(newPlot);\n      setTimeout(() => setTimer(null), 400);\n    }\n  };\n\n  // Editing functions\n  const toggleEditMode = () => {\n    setIsEditMode(!isEditMode);\n    if (!isEditMode) {\n      setSelectedNode(null);\n      setEditingNode(null);\n    }\n  };\n\n  const handleNodeEdit = (node) => {\n    if (isEditMode) {\n      setEditingNode(node);\n      setNewNodeData({ name: node.name, imports: node.imports || [] });\n    } else {\n      if (onNodeClick) {\n        onNodeClick(node);\n      }\n    }\n  };\n\n  const saveNodeEdit = () => {\n    if (editingNode && newNodeData.name) {\n      const updatedSource = source.map(node => \n        node.name === editingNode.name \n          ? { ...node, name: newNodeData.name, imports: newNodeData.imports }\n          : node\n      );\n      setSource(updatedSource);\n      setEditingNode(null);\n      setNewNodeData({ name: '', imports: [] });\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after editing\n      saveDiagram(updatedSource);\n    }\n  };\n\n  const addNewNode = () => {\n    if (newNodeData.name) {\n      const newSource = [...source, { name: newNodeData.name, imports: newNodeData.imports }];\n      setSource(newSource);\n      setShowAddNodeForm(false);\n      setNewNodeData({ name: '', imports: [] });\n      plotHierarchicalEdgeBundling(newSource);\n      // Auto-save after adding\n      saveDiagram(newSource);\n    }\n  };\n\n  const deleteNode = (nodeName) => {\n    if (window.confirm(`Are you sure you want to delete \"${nodeName}\"?`)) {\n      const updatedSource = source.filter(node => node.name !== nodeName);\n      setSource(updatedSource);\n      setSelectedNode(null);\n      plotHierarchicalEdgeBundling(updatedSource);\n      // Auto-save after deletion\n      saveDiagram(updatedSource);\n    }\n  };\n\n  // Save diagram data\n  const saveDiagram = async (dataToSave = source) => {\n    if (!dataToSave) return;\n    \n    setIsSaving(true);\n    setSaveStatus('Saving...');\n    \n    try {\n      // Try to save to backend first\n      await dataService.saveDiagram(diagramId, dataToSave, 'current-user');\n      setSaveStatus('Saved successfully!');\n      \n      // Also save to localStorage as backup\n      dataService.saveToLocalStorage(diagramId, dataToSave);\n      \n      setTimeout(() => setSaveStatus(''), 2000);\n    } catch (error) {\n      console.error('Failed to save to backend, using localStorage:', error);\n      // Fallback to localStorage\n      const saved = dataService.saveToLocalStorage(diagramId, dataToSave);\n      setSaveStatus(saved ? 'Saved locally' : 'Save failed');\n      setTimeout(() => setSaveStatus(''), 3000);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Export diagram\n  const exportDiagram = () => {\n    if (source) {\n      dataService.exportDiagram(source, `world-empires-${Date.now()}.json`);\n    }\n  };\n\n  // Import diagram\n  const importDiagram = (event) => {\n    const file = event.target.files[0];\n    if (file) {\n      dataService.importDiagram(file)\n        .then(data => {\n          setSource(data);\n          plotHierarchicalEdgeBundling(data);\n          setSaveStatus('Diagram imported successfully!');\n          setTimeout(() => setSaveStatus(''), 2000);\n        })\n        .catch(error => {\n          setSaveStatus('Import failed: ' + error.message);\n          setTimeout(() => setSaveStatus(''), 3000);\n        });\n    }\n  };\n\n  // HierarchicalEdgeBundling class (converted from original JavaScript)\n  const HierarchicalEdgeBundling = (chartElementId, infoElementId, classes) => {\n    const diameter = currentSize;\n    const radius = diameter / 2;\n    const innerRadius = radius - 120;\n\n    // Create circle cluster\n    const cluster = d3.layout.cluster()\n      .size([360, innerRadius])\n      .sort(null)\n      .value(function(d) { return d.size; });\n\n    const bundle = d3.layout.bundle();\n\n    const line = d3.svg.line.radial()\n      .interpolate(\"bundle\")\n      .tension(.9)\n      .radius(function(d) { return d.y; })\n      .angle(function(d) { return d.x / 180 * Math.PI; });\n\n    // Clear the container before rendering to prevent duplicate diagrams\n    d3.select(\"#\" + chartElementId).selectAll(\"*\").remove();\n\n    // Create SVG element\n    const svg = d3.select(\"#\" + chartElementId).append(\"svg\")\n      .attr(\"class\", \"bibleStudy\")\n      .attr(\"id\", \"g4\")\n      .append(\"g\")\n      .attr(\"transform\", \"translate(\" + radius + \",\" + radius + \")\");\n\n    // Link node \"birth place\"\n    let link = svg.append(\"g\").selectAll(\".link\"),\n        node = svg.append(\"g\").selectAll(\".node\");\n\n    // Classes is each \"object\" from the json\n    const nodes = cluster.nodes(packageHierarchy(classes)),\n          links = packageImports(nodes);\n\n    link = link\n      .data(bundle(links))\n      .enter().append(\"path\")\n      .each(function(d) { d.source = d[0], d.target = d[d.length - 1]; })\n      .attr(\"class\", \"link\")\n      .attr(\"d\", line);\n\n    // Node object\n    node = node\n      .data(nodes.filter(function(n) { return !n.children; }))\n      .enter().append(\"text\")\n      .attr(\"class\", \"node\")\n      .attr(\"dy\", \".31em\")\n      .attr(\"transform\", function(d) { \n        return \"rotate(\" + (d.x - 90) + \")translate(\" + (d.y + 8) + \",0)\" + (d.x < 180 ? \"\" : \"rotate(180)\"); \n      })\n      .style(\"text-anchor\", function(d) { return d.x < 180 ? \"start\" : \"end\"; })\n      .text(function(d) { return d.key; })\n      .on(\"mouseover\", mouseovered)\n      .on(\"mouseout\", mouseouted)\n      .on(\"click\", clicked)\n      .style(\"cursor\", isEditMode ? \"pointer\" : \"default\");\n\n    // Set height for the container\n    d3.select(\"#\" + chartElementId).style(\"height\", diameter + \"px\");\n\n    // Helper functions\n    function packageHierarchy(classes) {\n      const map = {};\n      \n      function find(name, data) {\n        let node = map[name], i;\n        if (!node) {\n          node = map[name] = data || {name: name, children: []};\n          if (name.length) {\n            node.parent = find(name.substring(0, i = name.lastIndexOf(\".\")));\n            node.parent.children.push(node);\n            node.key = name.substring(i + 1);\n          }\n        }\n        return node;\n      }\n      \n      classes.forEach(function(d) {\n        find(d.name, d);\n      });\n      \n      return map[\"\"];\n    }\n\n    function packageImports(nodes) {\n      const map = {},\n            imports = [];\n      \n      // Compute a map from name to node.\n      nodes.forEach(function(d) {\n        map[d.name] = d;\n      });\n      \n      // For each import, construct a link from the source to target node.\n      nodes.forEach(function(d) {\n        if (d.imports) d.imports.forEach(function(i) {\n          imports.push({source: map[d.name], target: map[i]});\n        });\n      });\n      \n      return imports;\n    }\n\n    function mouseovered(d) {\n      node\n        .each(function(n) { n.target = n.source = false; });\n      \n      link\n        .classed(\"link--source\", function(l) { if (l.target === d) return l.source.source = true; })\n        .classed(\"link--target\", function(l) { if (l.source === d) return l.target.target = true; })\n        .filter(function(l) { return l.target === d || l.source === d; })\n        .each(function() { this.parentNode.appendChild(this); });\n      \n      node\n        .classed(\"node--source\", function(n) { return n.source; })\n        .classed(\"node--target\", function(n) { return n.target; });\n    }\n\n    function mouseouted(d) {\n      link\n        .classed(\"link--source\", false)\n        .classed(\"link--target\", false);\n      \n      node\n        .classed(\"node--source\", false)\n        .classed(\"node--target\", false);\n    }\n\n    function clicked(d) {\n      handleNodeEdit(d);\n    }\n\n    function showTexts(d) {\n      // This would be implemented to show related Bible texts\n      // For now, we'll just log the clicked node\n      console.log('Clicked node:', d);\n    }\n  };\n\n  return (\n    <div className=\"row world-empires-row\">\n      <div className=\"col-12 col-lg-9 position-relative\">\n        {/* Visualization */}\n        <div id=\"chtHierarchicalEdgeBundling\" className=\"heb\">\n          {/* D3.js will render the visualization here */}\n          {/* Floating Edit Controls */}\n          <div className=\"edit-controls-float btn-group btn-group-sm float-end\" style={{ position: 'absolute', top: 12, right: 12, zIndex: 10 }}>\n            <button \n              className={`btn btn-sm ${isEditMode ? 'btn-danger' : 'btn-primary'}`}\n              onClick={toggleEditMode}\n              title={isEditMode ? 'Exit Edit Mode' : 'Enter Edit Mode'}\n            >\n              <i className={`mdi ${isEditMode ? 'mdi-close' : 'mdi-pencil'}`}></i>\n            </button>\n            {isEditMode && (\n              <>\n                <button \n                  className=\"btn btn-sm btn-success\"\n                  onClick={() => setShowAddNodeForm(true)}\n                  title=\"Add New Node\"\n                >\n                  <i className=\"mdi mdi-plus\"></i>\n                </button>\n                {selectedNode && (\n                  <button \n                    className=\"btn btn-sm btn-warning\"\n                    onClick={() => deleteNode(selectedNode.name)}\n                    title=\"Delete Selected\"\n                  >\n                    <i className=\"mdi mdi-delete\"></i>\n                  </button>\n                )}\n              </>\n            )}\n            <button \n              className=\"btn btn-sm btn-info\"\n              onClick={() => saveDiagram()}\n              disabled={isSaving}\n              title=\"Save\"\n            >\n              <i className=\"mdi mdi-content-save\"></i>\n            </button>\n            <button \n              className=\"btn btn-sm btn-secondary\"\n              onClick={exportDiagram}\n              title=\"Export\"\n            >\n              <i className=\"mdi mdi-export\"></i>\n            </button>\n            <label className=\"btn btn-sm btn-outline-secondary mb-0\" title=\"Import\">\n              <i className=\"mdi mdi-import\"></i>\n              <input\n                type=\"file\"\n                accept=\".json\"\n                onChange={importDiagram}\n                style={{ display: 'none' }}\n              />\n            </label>\n          </div>\n        </div>\n        {/* Save Status */}\n        {saveStatus && (\n          <div className=\"save-status mt-2 text-end\">\n            {saveStatus}\n          </div>\n        )}\n        {/* Add Node Form */}\n        {showAddNodeForm && (\n          <div className=\"add-node-form mt-2\">\n            <h4>Add New Node</h4>\n            <input\n              type=\"text\"\n              placeholder=\"Node name (e.g., flare.empires.new.NewEmpire)\"\n              value={newNodeData.name}\n              onChange={(e) => setNewNodeData({...newNodeData, name: e.target.value})}\n            />\n            <input\n              type=\"text\"\n              placeholder=\"Imports (comma-separated)\"\n              value={newNodeData.imports.join(', ')}\n              onChange={(e) => setNewNodeData({\n                ...newNodeData, \n                imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n              })}\n            />\n            <div className=\"form-buttons mt-2\">\n              <button className=\"btn btn-success btn-sm\" onClick={addNewNode}>Add Node</button>\n              <button className=\"btn btn-secondary btn-sm\" onClick={() => setShowAddNodeForm(false)}>Cancel</button>\n            </div>\n          </div>\n        )}\n        {/* Edit Node Form */}\n        {editingNode && (\n          <div className=\"edit-node-form mt-2\">\n            <h4>Edit Node: {editingNode.name}</h4>\n            <input\n              type=\"text\"\n              placeholder=\"Node name\"\n              value={newNodeData.name}\n              onChange={(e) => setNewNodeData({...newNodeData, name: e.target.value})}\n            />\n            <input\n              type=\"text\"\n              placeholder=\"Imports (comma-separated)\"\n              value={newNodeData.imports.join(', ')}\n              onChange={(e) => setNewNodeData({\n                ...newNodeData, \n                imports: e.target.value.split(',').map(s => s.trim()).filter(s => s)\n              })}\n            />\n            <div className=\"form-buttons mt-2\">\n              <button className=\"btn btn-success btn-sm\" onClick={saveNodeEdit}>Save Changes</button>\n              <button className=\"btn btn-secondary btn-sm\" onClick={() => setEditingNode(null)}>Cancel</button>\n            </div>\n          </div>\n        )}\n      </div>\n      <div className=\"col-12 col-lg-3 mobile\">\n        <InfoPanel />\n      </div>\n    </div>\n  );\n};\n\nexport default WorldEmpiresVisualization; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}